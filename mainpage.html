<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Home Page - Bubblio</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="style_login.css" />
</head>
<body>
  <div class="main-container container-fluid d-flex flex-column min-vh-100 p-0">
    <!-- Top bar -->
    <div class="d-flex justify-content-between align-items-center p-3 top-bar">
      <div class="d-flex align-items-center gap-2">
        <img src="img/bubblio_logo_no_text.png" alt="Bubblio Logo" class="logo-img" />
        <span class="welcome-text">Hello Anna!</span>
      </div>
      <div class="bubble-counter d-flex align-items-center gap-2">
        <img src="img/bubblio_bubble.png" alt="Bubble icon" class="bubble-icon" />
        <span class="bubble-number">21</span>
      </div>
    </div>

    <!-- Content -->
    <div class="content d-flex flex-grow-1 p-3 gap-4 flex-column flex-lg-row">
      <!-- Tanks with tabs -->
      <div class="tanks flex-grow-1">
        <ul class="nav nav-tabs mb-3" id="tankTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tank1-tab" data-bs-toggle="tab" data-bs-target="#tank1" type="button" role="tab" aria-controls="tank1" aria-selected="true">
              Tank 1
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tank2-tab" data-bs-toggle="tab" data-bs-target="#tank2" type="button" role="tab" aria-controls="tank2" aria-selected="false">
              Tank 2
            </button>
          </li>
        </ul>
        <div class="tab-content" id="tankTabsContent">
          <div class="tab-pane fade show active tank-card p-3 border rounded" id="tank1" role="tabpanel" aria-labelledby="tank1-tab">
            <ul class="list-unstyled">
              <li><input type="checkbox" /> Feed the fish</li>
              <li><input type="checkbox" /> Check water temperature</li>
              <li><input type="checkbox" /> Inspect water clarity</li>
              <li><input type="checkbox" /> Verify equipment is working</li>
              <li><input type="checkbox" /> Observe fish behavior and health</li>
            </ul>
          </div>
          <div class="tab-pane fade tank-card p-3 border rounded" id="tank2" role="tabpanel" aria-labelledby="tank2-tab">
            <ul class="list-unstyled">
              <li><input type="checkbox" /> Feed the fish</li>
              <li><input type="checkbox" /> Check water temperature</li>
              <li><input type="checkbox" /> Inspect water clarity</li>
              <li><input type="checkbox" /> Verify equipment is working</li>
              <li><input type="checkbox" /> Observe fish behavior and health</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Calendar + Upcoming tasks -->
      <div class="calendar-tasks flex-grow-1 d-flex flex-column gap-3">
        <div class="calendar p-3 rounded">
          <div class="d-flex justify-content-between align-items-center mb-3 calendar-header">
            <strong id="calendarMonthYear"></strong>
            <div class="calendar-controls">
              <button type="button" id="prevMonth" aria-label="Previous month">&lt;</button>
              <button type="button" id="nextMonth" aria-label="Next month">&gt;</button>
            </div>
          </div>
          <div class="calendar-grid d-grid" style="grid-template-columns: repeat(7, 1fr); gap: 10px;" id="calendarGrid"></div>
        </div>

        <!-- Upcoming Tasks -->
        <div class="upcoming-tasks p-3 border rounded position-relative">
          <h5>Upcoming tasks</h5>
          <ul id="task-list">
            <li><input type="checkbox" /> 17.08.2025 - Clean tank 1</li>
            <li><input type="checkbox" /> 17.08.2025 - Change water in tank 1</li>
            <li><input type="checkbox" /> 19.08.2025 - Observe fish health</li>
          </ul>
          <button type="button" class="btn-add-task" data-bs-toggle="modal" data-bs-target="#addTaskModal">+</button>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="addTaskModal" tabindex="-1" aria-labelledby="addTaskModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="addTaskModalLabel">Add New Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="addTaskForm">
                  <div class="mb-3">
                    <label for="taskDate" class="form-label">Date</label>
                    <input type="date" class="form-control" id="taskDate" required />
                  </div>
                  <div class="mb-3">
                    <label for="taskDescription" class="form-label">Task Description</label>
                    <input type="text" class="form-control" id="taskDescription" placeholder="Enter task" required />
                  </div>
                  <button type="submit" class="btn btn-primary w-100">Add Task</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Menu -->
    <footer class="bottom-menu bg-white shadow-sm rounded-pill mx-auto mb-3">
      <ul class="d-flex justify-content-around align-items-center m-0 p-2" style="width: 375px;">
        <li><a href="mainpage.html"><img src="img/mainpage_menu_icon.png" alt="Home" /></a></li>
        <li><a href="tanks.html"><img src="img/tank_menu_icon.png" alt="Tanks" /></a></li>
        <li><a href="journal.html"><img src="img/diary_menu_icon.png" alt="Journal" /></a></li>
        <li><a href="profile.html"><img src="img/profile_menu_icon.png" alt="Profile" /></a></li>
      </ul>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Calendar
      const calendarMonthYear = document.getElementById('calendarMonthYear');
      const calendarGrid = document.getElementById('calendarGrid');
      let today = new Date();
      let currentMonth = today.getMonth();
      let currentYear = today.getFullYear();

      function updateCalendar(month, year) {
        const firstDay = new Date(year, month).getDay();
        const daysInMonth = 32 - new Date(year, month, 32).getDate();
        calendarMonthYear.textContent = new Date(year, month).toLocaleString('default', { month: 'long', year: 'numeric' });
        calendarGrid.innerHTML = '';
        const weekDays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
        weekDays.forEach(day => {
          const div = document.createElement('div');
          div.textContent = day;
          calendarGrid.appendChild(div);
        });
        for (let i = 0; i < firstDay; i++) {
          const div = document.createElement('div');
          div.innerHTML = '';
          calendarGrid.appendChild(div);
        }
        for (let i = 1; i <= daysInMonth; i++) {
          const div = document.createElement('div');
          div.textContent = i;
          if (i === today.getDate() && year === today.getFullYear() && month === today.getMonth()) {
            div.classList.add('selected');
          }
          calendarGrid.appendChild(div);
        }
      }
      updateCalendar(currentMonth, currentYear);

      document.getElementById('prevMonth').addEventListener('click', () => {
        currentMonth--;
        if (currentMonth < 0) {
          currentMonth = 11;
          currentYear--;
        }
        updateCalendar(currentMonth, currentYear);
      });

      document.getElementById('nextMonth').addEventListener('click', () => {
        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
        updateCalendar(currentMonth, currentYear);
      });

      // Upcoming Tasks
      const taskList = document.getElementById('task-list');
      const addTaskForm = document.getElementById('addTaskForm');
      const tasks = [];
      document.querySelectorAll('#task-list li').forEach(li => {
        tasks.push(li.textContent.trim());
      });

      addTaskForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const date = document.getElementById('taskDate').value;
        const description = document.getElementById('taskDescription').value;
        if (date && description) {
          const newTask = `${formatDate(date)} - ${description}`;
          tasks.push(newTask);
          tasks.sort(sortByDate);
          renderTasks();
          const addTaskModal = bootstrap.Modal.getInstance(document.getElementById('addTaskModal'));
          addTaskModal.hide();
          addTaskForm.reset();
        }
      });

      function renderTasks() {
        taskList.innerHTML = '';
        tasks.forEach(task => {
          const li = document.createElement('li');
          li.innerHTML = `<input type="checkbox" /> ${task}`;
          taskList.appendChild(li);
        });
      }

      function formatDate(inputDate) {
        const date = new Date(inputDate);
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}.${month}.${year}`;
      }

      function sortByDate(a, b) {
        const dateA = parseDate(a);
        const dateB = parseDate(b);
        return dateA - dateB;
      }

      function parseDate(task) {
        const match = task.match(/^(\d{2})\.(\d{2})\.(\d{4})/);
        if (match) {
          return new Date(match[3], match[2] - 1, match[1]);
        }
        return new Date();
      }

      // Strike-through for Upcoming Tasks
      taskList.addEventListener('change', function(e) {
        if (e.target.type === 'checkbox') {
          const li = e.target.closest('li');
          if (e.target.checked) {
            li.classList.add('completed');
          } else {
            li.classList.remove('completed');
          }
        }
      });

      // Strike-through for Tanks
      document.addEventListener('change', function(e) {
        if (e.target.type === 'checkbox' && e.target.closest('.tank-card li')) {
          const li = e.target.closest('li');
          if (e.target.checked) {
            li.classList.add('completed');
          } else {
            li.classList.remove('completed');
          }
        }
      });

      // Highlight active bottom menu icon
      document.querySelectorAll('.bottom-menu a').forEach(link => {
        if (window.location.href.includes(link.getAttribute('href'))) {
          link.classList.add('active');
        }
      });
    });
  </script>
</body>
</html>
